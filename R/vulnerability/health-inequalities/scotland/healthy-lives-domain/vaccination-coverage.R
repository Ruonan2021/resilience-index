library(httr)
library(readxl)
library(dplyr)
library(geographr)
library(sf)
library(stringr)

# Create Scotland LAD code to name lookup
lookup <-
  boundaries_lad %>%
  as_tibble() %>%
  select(lad_name, lad_code) %>%
  filter(str_detect(lad_code, "^S")) %>%
  arrange(lad_name)

# HPV
# Source: https://beta.isdscotland.org/find-publications-and-data/population-health/child-health/hpv-immunisation-statistics-scotland/
# Use Sheet 'Table 4b (S4- LA)', as it contains the cummaltive counts from S1-S4 (see footnotes)
GET(
  "https://beta.isdscotland.org/media/6895/2020-12-22-hpv-tables.xlsx",
  write_disk(tf <- tempfile(fileext = ".xlsx"))
)

hpv_raw <-
  read_excel(tf, sheet = "Table 4b (S4- LA)", skip = 5)

hpv <-
  hpv_raw %>%
  slice(1:32) %>%
  select(lad_name = `...1`, hpv_vaccine_rate = `Uptake rate (%)...4`) %>%
  mutate(hpv_vaccine_rate = as.double(hpv_vaccine_rate)) %>%
  mutate(lad_name = if_else(lad_name == "Dumfries & Galloway", "Dumfries and Galloway", lad_name)) %>%
  left_join(lookup, by = "lad_name") %>%
  relocate(lad_code, .after = lad_name)

# To add:

# Teenage booster immunisations
# Source: https://beta.isdscotland.org/find-publications-and-data/population-health/child-health/teenage-booster-immunisation-statistics-scotland/

# Childhood immunisations
# Source: https://beta.isdscotland.org/find-publications-and-data/population-health/child-health/childhood-immunisation-statistics-scotland/
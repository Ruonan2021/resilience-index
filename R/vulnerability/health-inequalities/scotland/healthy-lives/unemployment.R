library(httr)
library(readxl)
library(readr)
library(dplyr)
library(stringr)

GET(
  "https://www.ons.gov.uk/file?uri=/employmentandlabourmarket/peoplenotinwork/unemployment/datasets/modelledunemploymentforlocalandunitaryauthoritiesm01/current/modelbasedunemploymentdataapril2021.xls",
  write_disk(tf <- tempfile(fileext = ".xls"))
)

unemployment_raw <-
  read_excel(tf, sheet = "LA,UA Rates", skip = 2)

unemployment <-
  unemployment_raw %>%
  select(
    lad_code = ...2,
    unemployment_percent = `Jan 2020 to Dec 2020`
  ) %>%
  filter(str_detect(lad_code, "^S")) %>%
  mutate(unemployment_percent = as.double(unemployment_percent)) %>%
  mutate(unemployment_percent = unemployment_percent / 100)

write_rds(unemployment, "data/vulnerability/health-inequalities/scotland/healthy-lives/unemployment.rds")
library(httr)
library(readxl)
library(readr)
library(dplyr)
library(stringr)
library(geographr)

# Lookup
lookup <-
  boundaries_lad %>%
  select(-geometry) %>%
  as_tibble() %>%
  filter(str_detect(lad_code, "^S"))

# Source: https://www.gov.scot/publications/scottish-index-of-multiple-deprivation-2020v2-indicator-data/
GET(
  "https://www.gov.scot/binaries/content/documents/govscot/publications/statistics/2020/01/scottish-index-of-multiple-deprivation-2020-indicator-data/documents/simd_2020_indicators/simd_2020_indicators/govscot%3Adocument/SIMD%2B2020v2%2B-%2Bindicators.xlsx",
  write_disk(tf <- tempfile(fileext = ".xlsx"))
)

gp_raw <-
  read_excel(tf, sheet = "Data")

gp <-
  gp_raw %>%
  select(
    lad_name = Council_area,
    gp_distance = drive_GP,
  ) %>%
  mutate(
    lad_name = if_else(
      lad_name == "Na h-Eileanan an Iar",
      "Na h-Eileanan Siar",
      lad_name
    )
  ) %>%
  group_by(lad_name) %>%
  summarise(gp_distance = mean(gp_distance))

gp <-
  gp %>%
  left_join(lookup, by = "lad_name") %>%
  relocate(lad_code) %>%
  select(-lad_name)

write_rds(gp, "data/vulnerability/health-inequalities/scotland/healthy-places/distance-to-gp.rds")
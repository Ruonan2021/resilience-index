# ---- Load ----
library(tidyverse)
library(httr)
library(readxl)
library(geographr)
library(sf)

source("R/utils.R")

wales_lookup <-
  boundaries_lad %>%
  as_tibble() %>%
  select(starts_with("lad")) %>%
  filter_codes(lad_code, "^W")

GET(
  "https://www2.nphs.wales.nhs.uk/PubHObservatoryProjDocs.nsf/3653c00e7bb6259d80256f27004900db/920b258a5a6102fc802581a1003c196d/$FILE/PHOFDataDownload2017_v1.xlsx",
  write_disk(tf <- tempfile(fileext = ".xslx"))
)

excel_sheets(tf)


# # ---- Build table ----
# # Public Health Wales Observatory uses Tableua to present data, with no
# # means to export the raw data into a consumable format. This means the data
# # has to be manually inputted.

# frailty <-
#   wales_lookup %>%
#   mutate(
#     suicide_rate_per_100000 = case_when(
#       lad_name == "Isle of Anglesey" ~ 524.2,
#       lad_name == "Gwynedd" ~ 541.6,
#       lad_name == "Conwy" ~ 555.0,
#       lad_name == "Denbighshire" ~ 624.6,
#       lad_name == "Flintshire" ~ 634.6,
#       lad_name == "Wrexham" ~ 594.2,
#       lad_name == "Ceredigion" ~ 566.2,
#       lad_name == "Pembrokeshire" ~ 548.9,
#       lad_name == "Carmarthenshire" ~ 476.1,
#       lad_name == "Swansea" ~ 600.3,
#       lad_name == "Neath Port Talbot" ~ 679.8,
#       lad_name == "Bridgend" ~ 727.2,
#       lad_name == "Vale of Glamorgan" ~ 548.9,
#       lad_name == "Cardiff" ~ 582.7,
#       lad_name == "Rhondda Cynon Taf" ~ 619.1,
#       lad_name == "Caerphilly" ~ 611.9,
#       lad_name == "Blaenau Gwent" ~ 612.2,
#       lad_name == "Torfaen" ~ 468.7,
#       lad_name == "Monmouthshire" ~ 414.9,
#       lad_name == "Newport" ~ 591.7,
#       lad_name == "Powys" ~ 541.1,
#       lad_name == "Merthyr Tydfil" ~ 781.8
#     )
#   ) %>%
#   select(-lad_name)

# write_rds(frailty, "data/vulnerability/health-inequalities/wales/healthy-people/frailty.rds")
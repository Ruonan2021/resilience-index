#  Load package
library(httr)
library(readODS)
library(dplyr)
source("R/utils.R")

# Source: https://gov.wales/welsh-index-multiple-deprivation-full-index-update-ranks-2019
GET(
  url = "https://gov.wales/sites/default/files/statistics-and-research/2019-11/welsh-index-multiple-deprivation-2019-index-and-domain-ranks-by-small-area.ods",
  write_disk(tf <- tempfile(fileext = ".ods"))
)

# For all ranks: 1 is most deprived
housing_raw <- read_ods(tf, sheet = "WIMD_2019_ranks", skip = 2)

housing_clean <-
  housing_raw %>%
  select(
    lsoa_code = `LSOA Code`,
    housing_rank = `Housing`
  ) %>%
  as_tibble()

housing_lsoa <-
  housing_clean %>%
  mutate(
    deciles =
      quantise(
        overall_rank,
        num_quantiles = 10,
        highest_quantile_worst = FALSE
      )
  )

str(housing_clean)
str(housing_lsoa)